(()=>{var e={363:e=>{e.exports={addData:function(e,t,o){for(let n=0;n<t.Length;n++)e[t[n]]=o[n]},removeData:function(e){},storeData:function(e){fetch(url+"/store_data",{method:"POST",headers:{},body:e}).then((e=>e.json())).then((e=>console.log(JSON.stringify(e))))}}}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,o),a.exports}(()=>{const{addData:e,removeData:t}=o(363);let n=1;const r={r:103,g:215,b:240},a={r:166,g:224,b:44},s={r:250,g:36,b:115},i={r:254,g:149,b:34},c=[r,a,s,i],l=()=>{const e=1400-3.1*X.game.cubeCount;return Math.max(e,550)};let h=!1,y={x:0,y:0},x={x:0,y:0};const m=-400,d="#262e36",u=120,f=[],p=40,z=p/3,g=document.querySelector("#c"),v=900,w=.45*v,D=.65*v,b=D-w,M=[],S=[],E=[],k=[],I=Symbol("GAME_MODE_RANKED"),T=Symbol("GAME_MODE_CASUAL"),C=Symbol("MENU_MAIN"),P=Symbol("MENU_PAUSE"),L=Symbol("MENU_SCORE"),X={game:{mode:I,time:0,score:0,cubeCount:0,sessionTry:0},menus:{active:C}},Y=()=>!X.menus.active,Z=()=>!!X.menus.active,W=()=>X.game.mode===T,j=()=>X.menus.active===P,_="__menja__highScore",A=()=>{const e=localStorage.getItem(_);return e?parseInt(e,10):0};let N=A();const U=e=>{N=A(),localStorage.setItem(_,String(e))},H=()=>X.game.score>N,O=e=>document.querySelector(e),B=(e,t)=>e.addEventListener("click",t),R=e=>e.toLocaleString(),F=(Math.PI,2*Math.PI),V=(Math.PI,(e,t,o)=>Math.min(Math.max(e,t),o)),$=(e,t,o)=>(t-e)*o+e,q=(e,t)=>Math.random()*(t-e)+e,G=e=>e[Math.random()*e.length|0],J=(e,t)=>{let o,n;return t<.5?(o=0,n=1-2*t):(o=255,n=2*t-1),"#"+(0|$(e.r,o,n)).toString(16).padStart(2,"0")+(0|$(e.g,o,n)).toString(16).padStart(2,"0")+(0|$(e.b,o,n)).toString(16).padStart(2,"0")},K=[],Q=(e,t=1)=>{let o=0,n=0;const r={rechargeTime:e,units:t},a=()=>((()=>{const e=X.game.time;e<n?o=0:(o-=e-n,o<0&&(o=0)),n=e})(),o<=e*(t-1)),s={canUse:a,useIfAble(){const t=a();return t&&(o+=e),t},mutate(n){n.rechargeTime&&(o-=e-n.rechargeTime,o<0&&(o=0),e=n.rechargeTime),n.units&&(t=n.units)},reset(){o=0,n=0,this.mutate(r)}};return K.push(s),s},ee=({chance:e,cooldownPerSpawn:t,maxSpawns:o})=>{const n=Q(t,o);return{shouldSpawn:()=>Math.random()<=e&&n.useIfAble(),mutate(t){t.chance&&(e=t.chance),n.mutate({rechargeTime:t.cooldownPerSpawn,units:t.maxSpawns})}}},te=e=>{const t=Math.hypot(e.x,e.y,e.z);return{x:e.x/t,y:e.y/t,z:e.z/t}};function oe(e){return e.map((e=>({x:e.x,y:e.y,z:e.z})))}function ne(e,t){const o=e.length;for(let n=0;n<o;n++){const o=e[n],r=t[n];r.x=o.x,r.y=o.y,r.z=o.z}}function re(e){!function(e){3===e.vertices.length?function(e){const t=e.vertices;e.middle.x=(t[0].x+t[1].x+t[2].x)/3,e.middle.y=(t[0].y+t[1].y+t[2].y)/3,e.middle.z=(t[0].z+t[1].z+t[2].z)/3}(e):function(e){const t=e.vertices;e.middle.x=(t[0].x+t[1].x+t[2].x+t[3].x)/4,e.middle.y=(t[0].y+t[1].y+t[2].y+t[3].y)/4,e.middle.z=(t[0].z+t[1].z+t[2].z+t[3].z)/4}(e)}(e);const t=e.middle.x,o=e.middle.y,n=e.middle.z-v;e.depth=Math.hypot(t,o,n)}function ae(e,t){const o=e.vertices[0],n=e.vertices[1],r=e.vertices[2],a=o.x-n.x,s=o.y-n.y,i=o.z-n.z,c=o.x-r.x,l=o.y-r.y,h=o.z-r.z,y=s*h-i*l,x=i*c-a*h,m=a*l-s*c,d=Math.hypot(y,x,m),u=e[t];u.x=y/d,u.y=x/d,u.z=m/d}function se(e,t,o,n,r,a,s,i,c,l,h){const y=Math.sin(a),x=Math.cos(a),m=Math.sin(s),d=Math.cos(s),u=Math.sin(i),f=Math.cos(i);e.forEach(((e,a)=>{const s=t[a],i=e.x,p=e.z*y+e.y*x,z=e.z*x-e.y*y,g=i*d-z*m,v=g*f-p*u,w=g*u+p*f,D=i*m+z*d;s.x=v*c+o,s.y=w*l+n,s.z=D*h+r}))}const ie=e=>{const t=1*v/(v-e.z);e.x=e.x*t,e.y=e.y*t};function ce({scale:e=1}){return{vertices:[{x:-e,y:-e,z:e},{x:e,y:-e,z:e},{x:e,y:e,z:e},{x:-e,y:e,z:e},{x:-e,y:-e,z:-e},{x:e,y:-e,z:-e},{x:e,y:e,z:-e},{x:-e,y:e,z:-e}],polys:[{vIndexes:[0,1,2,3]},{vIndexes:[7,6,5,4]},{vIndexes:[3,2,6,7]},{vIndexes:[4,5,1,0]},{vIndexes:[5,6,2,1]},{vIndexes:[0,3,7,4]}]}}function le({recursionLevel:e,splitFn:t,color:o,scale:n=1}){const r=e=>1/3**e;let a=[{x:0,y:0,z:0}];for(let o=1;o<=e;o++){const e=2*r(o),n=[];a.forEach((o=>{n.push(...t(o,e))})),a=n}const s={vertices:[],polys:[]},i=ce({scale:1});return i.vertices.forEach((e=>t=>{t.x*=e,t.y*=e,t.z*=e})(r(e))),r(e),a.forEach(((e,t)=>{Math.max(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z)),s.vertices.push(...i.vertices.map((t=>({x:(t.x+e.x)*n,y:(t.y+e.y)*n,z:(t.z+e.z)*n})))),s.polys.push(...i.polys.map((e=>{return{vIndexes:e.vIndexes.map((o=8*t,e=>o+e))};var o})))})),s}function he(e,t){return[{x:e.x+t,y:e.y-t,z:e.z+t},{x:e.x+t,y:e.y-t,z:e.z+0},{x:e.x+t,y:e.y-t,z:e.z-t},{x:e.x+0,y:e.y-t,z:e.z+t},{x:e.x+0,y:e.y-t,z:e.z-t},{x:e.x-t,y:e.y-t,z:e.z+t},{x:e.x-t,y:e.y-t,z:e.z+0},{x:e.x-t,y:e.y-t,z:e.z-t},{x:e.x+t,y:e.y+t,z:e.z+t},{x:e.x+t,y:e.y+t,z:e.z+0},{x:e.x+t,y:e.y+t,z:e.z-t},{x:e.x+0,y:e.y+t,z:e.z+t},{x:e.x+0,y:e.y+t,z:e.z-t},{x:e.x-t,y:e.y+t,z:e.z+t},{x:e.x-t,y:e.y+t,z:e.z+0},{x:e.x-t,y:e.y+t,z:e.z-t},{x:e.x+t,y:e.y+0,z:e.z+t},{x:e.x+t,y:e.y+0,z:e.z-t},{x:e.x-t,y:e.y+0,z:e.z+t},{x:e.x-t,y:e.y+0,z:e.z-t}]}function ye(e,t=1e-4){const{vertices:o,polys:n}=e,r=(e,o)=>Math.abs(e.x-o.x)<t&&Math.abs(e.y-o.y)<t&&Math.abs(e.z-o.z)<t,a=(e,t)=>{const o=e.vIndexes,n=t.vIndexes;return!(o[0]!==n[0]&&o[0]!==n[1]&&o[0]!==n[2]&&o[0]!==n[3]||o[1]!==n[0]&&o[1]!==n[1]&&o[1]!==n[2]&&o[1]!==n[3]||o[2]!==n[0]&&o[2]!==n[1]&&o[2]!==n[2]&&o[2]!==n[3]||o[3]!==n[0]&&o[3]!==n[1]&&o[3]!==n[2]&&o[3]!==n[3])};o.forEach(((e,t)=>{e.originalIndexes=[t]}));for(let e=o.length-1;e>=0;e--)for(let t=e-1;t>=0;t--){const n=o[e],a=o[t];if(r(n,a)){o.splice(e,1),a.originalIndexes.push(...n.originalIndexes);break}}o.forEach(((e,t)=>{n.forEach((o=>{o.vIndexes.forEach(((o,n,r)=>{e.originalIndexes.includes(o)&&(r[n]=t)}))}))})),n.forEach((e=>{const t=e.vIndexes;e.sum=t[0]+t[1]+t[2]+t[3]})),n.sort(((e,t)=>t.sum-e.sum));for(let e=n.length-1;e>=0;e--)for(let t=e-1;t>=0;t--){const o=n[e],r=n[t];if(o.sum!==r.sum)break;if(a(o,r)){n.splice(e,1),n.splice(t,1),e--;break}}return e}class xe{constructor({model:e,color:t,wireframe:o=!1}){const n=oe(e.vertices),r=oe(e.vertices),a=(e=>"#"+(0|e.r).toString(16).padStart(2,"0")+(0|e.g).toString(16).padStart(2,"0")+(0|e.b).toString(16).padStart(2,"0"))(t),s=J(t,.4),i=e.polys.map((e=>({vertices:e.vIndexes.map((e=>n[e])),color:t,wireframe:o,strokeWidth:o?2:0,strokeColor:a,strokeColorDark:s,depth:0,middle:{x:0,y:0,z:0},normalWorld:{x:0,y:0,z:0},normalCamera:{x:0,y:0,z:0}}))),c=e.polys.map((e=>({vertices:e.vIndexes.map((e=>r[e])),wireframe:o,normalWorld:{x:0,y:0,z:0}})));this.projected={},this.model=e,this.vertices=n,this.polys=i,this.shadowVertices=r,this.shadowPolys=c,this.reset()}reset(){this.x=0,this.y=0,this.z=0,this.xD=0,this.yD=0,this.zD=0,this.rotateX=0,this.rotateY=0,this.rotateZ=0,this.rotateXD=0,this.rotateYD=0,this.rotateZD=0,this.scaleX=1,this.scaleY=1,this.scaleZ=1,this.projected.x=0,this.projected.y=0}transform(){se(this.model.vertices,this.vertices,this.x,this.y,this.z,this.rotateX,this.rotateY,this.rotateZ,this.scaleX,this.scaleY,this.scaleZ),ne(this.vertices,this.shadowVertices)}project(){((e,t)=>{const o=1*v/(v-e.z);t.x=e.x*o,t.y=e.y*o})(this,this.projected)}}const me=[],de=new Map(c.map((e=>[e,[]]))),ue=new Map(c.map((e=>[e,[]]))),fe=(()=>{const e=ee({chance:.5,cooldownPerSpawn:1e4,maxSpawns:1});let t=!1;const o=ee({chance:.3,cooldownPerSpawn:12e3,maxSpawns:1}),n=ee({chance:.1,cooldownPerSpawn:1e4,maxSpawns:1}),c=[["x","y"],["y","z"],["z","x"]];return function(){t&&X.game.score<=2e3?t=!1:!t&&X.game.score>2e3&&(t=!0,o.mutate({maxSpawns:2}));let l=G([r,a,i]),h=!1,y=1;const x=X.game.cubeCount>=25&&Y()&&n.shouldSpawn();X.game.cubeCount>=10&&e.shouldSpawn()?(l=r,h=!0):X.game.cubeCount>=25&&o.shouldSpawn()&&(l=s,y=3);const m=function(e,t){let o=(t?ue:de).get(e).pop();return o||(o=new xe({model:ye(le({recursionLevel:1,splitFn:he,scale:p})),color:e,wireframe:t}),o.color=e,o.wireframe=t,o.hit=!1,o.maxHealth=0,o.health=0),o}(l,h);m.hit=!1,m.maxHealth=3,m.health=y,pe(m,0);const d=[.1*Math.random()-.05,.1*Math.random()-.05];x&&(d[0]=-.25,d[1]=0,m.rotateZ=q(0,F));const u=G(c);return d.forEach(((e,t)=>{switch(u[t]){case"x":m.rotateXD=e;break;case"y":m.rotateYD=e;break;case"z":m.rotateZD=e}})),m}})(),pe=(e,t)=>{if(e.health+=t,!e.wireframe){const t=e.health-1,o="rgb(170,221,255)";for(let n of e.polys)n.strokeWidth=t,n.strokeColor=o}},ze=e=>{e.reset(),(e.wireframe?ue:de).get(e.color).push(e)},ge=[],ve=new Map(c.map((e=>[e,[]]))),we=new Map(c.map((e=>[e,[]]))),De=(()=>{const e=he({x:0,y:0,z:0},2*z),t=oe(e),o=oe(e),n=oe(e),r=e.map(te),a=oe(r),s=e.length;function i(e){let t=(e.wireframe?we:ve).get(e.color).pop();return t||(t=new xe({model:ce({scale:z}),color:e.color,wireframe:e.wireframe}),t.color=e.color,t.wireframe=e.wireframe),t}return(c,l=1)=>{se(e,t,c.x,c.y,c.z,c.rotateX,c.rotateY,c.rotateZ,1,1,1),se(e,o,c.x-c.xD,c.y-c.yD,c.z-c.zD,c.rotateX-c.rotateXD,c.rotateY-c.rotateYD,c.rotateZ-c.rotateZD,1,1,1);for(let e=0;e<s;e++){const r=t[e],a=o[e],s=n[e];s.x=r.x-a.x,s.y=r.y-a.y,s.z=r.z-a.z}se(r,a,0,0,0,c.rotateX,c.rotateY,c.rotateZ,1,1,1);for(let e=0;e<s;e++){const o=t[e],r=n[e],s=a[e],h=i(c);h.x=o.x,h.y=o.y,h.z=o.z,h.rotateX=c.rotateX,h.rotateY=c.rotateY,h.rotateZ=c.rotateZ;const y=2*l,x=2*l,m=.015;h.xD=r.x+s.x*y+Math.random()*x,h.yD=r.y+s.y*y+Math.random()*x,h.zD=r.z+s.z*y+Math.random()*x,h.rotateXD=h.xD*m,h.rotateYD=h.yD*m,h.rotateZD=h.zD*m,ge.push(h)}}})(),be=e=>{e.reset(),(e.wireframe?we:ve).get(e.color).push(e)},Me=[],Se=[];function Ee(e,t,o,n){const r=Se.pop()||{};return r.x=e+.5*o,r.y=t+.5*n,r.xD=o,r.yD=n,r.life=q(200,300),r.maxLife=r.life,Me.push(r),r}function ke(e,t,o,n){const r=F/o;for(let a=0;a<o;a++){const o=a*r+r*Math.random(),s=(1-Math.random()**3)*n;Ee(e,t,Math.sin(o)*s,Math.cos(o)*s)}}let Ie;function Te(e){Ie?ne(e.vertices,Ie):Ie=oe(e.vertices),Ie.forEach((e=>{Math.random()<.4&&(ie(e),Ee(e.x,e.y,q(-12,12),q(-12,12)))}))}function Ce(e){Se.push(e)}const Pe=O(".hud"),Le=O(".score-lbl"),Xe=O(".cube-count-lbl");function Ye(){W()?(Le.style.display="none",Xe.style.opacity=1):(Le.innerText=`SCORE: ${X.game.score}`,Le.style.display="block",Xe.style.opacity=.65),Xe.innerText=`CUBES SMASHED: ${X.game.cubeCount}`}var Ze,We;Ye(),We=()=>Ke(),(Ze=O(".pause-btn")).addEventListener("touchstart",We),Ze.addEventListener("mousedown",We);const je=O(".slowmo"),_e=O(".slowmo__bar"),Ae=O(".menus"),Ne=O(".menu--main"),Ue=O(".menu--pause"),He=O(".menu--score"),Oe=O(".final-score-lbl"),Be=O(".high-score-lbl");function Re(e){e.classList.add("active")}function Fe(e){e.classList.remove("active")}function Ve(){switch(Fe(Ne),Fe(Ue),Fe(He),X.menus.active){case C:Re(Ne);break;case P:Re(Ue);break;case L:Oe.textContent=R(X.game.score),H()?Be.textContent="New High Score!":Be.textContent=`High Score: ${R(A())}`,Re(He)}var e;e=!Z(),Pe.style.display=e?"block":"none",Ae.classList.toggle("has-active",Z()),Ae.classList.toggle("interactive-mode",Z()&&h)}function $e(e){X.menus.active=e,Ve()}function qe(e){Y()&&(X.game.score+=e,X.game.score<0&&(X.game.score=0),Ye())}function Ge(e){X.game.mode=e}function Je(){!function(){for(;me.length;)ze(me.pop())}(),X.game.time=0,K.forEach((e=>e.reset())),X.game.score=0,Ye(),X.game.cubeCount=0,Ye(),et=l()}function Ke(){Y()&&$e(P)}function Qe(){j()&&$e(null)}Ve(),B(O(".play-normal-btn"),(()=>{Ge(I),$e(null),Je()})),B(O(".play-casual-btn"),(()=>{Ge(T),$e(null),Je()})),B(O(".resume-btn"),(()=>Qe())),B(O(".menu-btn--pause"),(()=>$e(C))),B(O(".play-again-btn"),(()=>{$e(null),Je()})),B(O(".menu-btn--score"),(()=>$e(C))),B(O(".play-normal-btn"),(()=>{Ge(I),$e(null),Je()})),B(O(".play-casual-btn"),(()=>{Ge(T),$e(null),Je()})),B(O(".resume-btn"),(()=>Qe())),B(O(".menu-btn--pause"),(()=>$e(C))),B(O(".play-again-btn"),(()=>{$e(null),Je()})),B(O(".menu-btn--score"),(()=>$e(C))),window.addEventListener("keydown",(e=>{"p"===e.key&&(j()?Qe():Ke())}));let et=0;const tt={x:0,y:0},ot={x:0,y:0};let nt=0,rt=0;let at=1;function st(e,t){h||(h=!0,y.x=e,y.y=t,Z()&&Ve())}function it(){h&&(h=!1,f.push({touchBreak:!0,life:u}),Z()&&Ve())}function ct(e,t){h&&(y.x=e,y.y=t)}if("PointerEvent"in window)g.addEventListener("pointerdown",(e=>{e.isPrimary&&st(e.clientX,e.clientY)})),g.addEventListener("pointerup",(e=>{e.isPrimary&&it()})),g.addEventListener("pointermove",(e=>{e.isPrimary&&ct(e.clientX,e.clientY)})),document.body.addEventListener("mouseleave",it);else{let e=null;g.addEventListener("touchstart",(t=>{if(!h){const o=t.changedTouches[0];e=o.identifier,st(o.clientX,o.clientY)}})),g.addEventListener("touchend",(t=>{for(let o of t.changedTouches)if(o.identifier===e){it();break}})),g.addEventListener("touchmove",(t=>{for(let o of t.changedTouches)if(o.identifier===e){ct(o.clientX,o.clientY),t.preventDefault();break}}),{passive:!1})}!function(){const e=g.getContext("2d"),t=window.devicePixelRatio||1;let o,r,a;function s(){const e=window.innerWidth,n=window.innerHeight;o=n/1e3,r=e/o,a=n/o,g.width=e*t,g.height=n*t,g.style.width=e+"px",g.style.height=n+"px"}s(),window.addEventListener("resize",s);let i=0;function c(s){let c=s-i;if(i=s,z(),j())return;c<0?c=17:c>68&&(c=68);const v=r/2,I=a/2;x.x=y.x/o-v,x.y=y.y/o-I;const T=c/16.6667;(function(e,t,o,r,a){if(X.game.time+=o,nt>0)nt-=o,nt<0&&(nt=0),at=h?.075:.3;else{const e=Z()&&h;at=e?.025:1}var s;s=nt/1500,je.style.opacity=0===s?0:1,_e.style.transform=`scaleX(${s.toFixed(3)})`,n+=(at-n)/22*a,n=V(n,0,1);const i=e/2,c=t/2,y=1-.022*r,d=1-.1*r,z=1/(.75*r+.25);tt.x=0,tt.y=0,ot.x=0,ot.y=0;const g=f[f.length-1];h&&g&&!g.touchBreak&&(tt.x=x.x-g.x,tt.y=x.y-g.y,ot.x=tt.x*z,ot.y=tt.y*z);const v=Math.hypot(tt.x,tt.y),w=v*z;for(f.forEach((e=>e.life-=o)),h&&f.push({x:x.x,y:x.y,life:u});f[0]&&f[0].life<=0;)f.shift();if(et-=o,et<=0){rt>0?(rt--,et=300):et=l();const e=fe(),t=Math.min(.8*i,450);e.x=Math.random()*t*2-t,e.y=c+100,e.z=Math.random()*p*2-p,e.xD=Math.random()*(-2*e.x/120),e.yD=-20,me.push(e)}const b=-i+p,I=i-p,T=-c-120;e:for(let e=me.length-1;e>=0;e--){const t=me[e];if(t.x+=t.xD*r,t.y+=t.yD*r,t.y<T&&(t.y=T,t.yD=0),t.x<b?(t.x=b,t.xD*=-.4):t.x>I&&(t.x=I,t.xD*=-.4),t.z<m&&(t.z=m,t.zD*=-.4),t.yD+=.3*r,t.rotateX+=t.rotateXD*r,t.rotateY+=t.rotateYD*r,t.rotateZ+=t.rotateZD*r,t.transform(),t.project(),t.y>c+100){me.splice(e,1),ze(t),Y()&&(W()?qe(-25):(console.log("Game has ended!!"),X.game.score,H(),X.game.sessionTry,X.game.sessionTry+=1,it(),H()&&U(X.game.score),X.game.sessionTry<5?(console.log("%d tries left",5-X.game.sessionTry),$e(L)):$e(L)));continue}const o=Math.ceil(v/p*2);for(let n=1;n<=o;n++){const r=1-n/o,a=x.x-tt.x*r,s=x.y-tt.y*r;if(Math.hypot(a-t.projected.x,s-t.projected.y)<=50){if(!t.hit){t.hit=!0,t.xD+=.1*ot.x,t.yD+=.1*ot.y,t.rotateXD+=.001*ot.y,t.rotateYD+=.001*ot.x;const o=7+.125*w;w>60?(t.health--,qe(10),t.health<=0?(Y()&&(X.game.cubeCount+=1,Ye()),De(t,z),ke(a,s,8,o),t.wireframe&&(nt=1500,et=0,rt=2),me.splice(e,1),ze(t)):(ke(a,s,8,o),Te(t),pe(t,0))):(qe(5),ke(a,s,3,o))}continue e}}t.hit=!1}const C=-386.6666666666667,P=-e,j=e;for(let e=ge.length-1;e>=0;e--){const t=ge[e];t.x+=t.xD*r,t.y+=t.yD*r,t.z+=t.zD*r,t.xD*=y,t.yD*=y,t.zD*=y,t.y<T&&(t.y=T,t.yD=0),t.z<C&&(t.z=C,t.zD*=-.4),t.yD+=.3*r,t.rotateX+=t.rotateXD*r,t.rotateY+=t.rotateYD*r,t.rotateZ+=t.rotateZD*r,t.transform(),t.project(),(t.projected.y>c+50||t.projected.x<P||t.projected.x>j||t.z>D)&&(ge.splice(e,1),be(t))}for(let e=Me.length-1;e>=0;e--){const t=Me[e];t.life-=o,t.life<=0?(Me.splice(e,1),Ce(t)):(t.x+=t.xD*r,t.y+=t.yD*r,t.xD*=d,t.yD*=d,t.yD+=.3*r)}M.length=0,S.length=0,E.length=0,k.length=0,me.forEach((e=>{M.push(...e.vertices),S.push(...e.polys),E.push(...e.shadowVertices),k.push(...e.shadowPolys)})),ge.forEach((e=>{M.push(...e.vertices),S.push(...e.polys),E.push(...e.shadowVertices),k.push(...e.shadowPolys)})),S.forEach((e=>ae(e,"normalWorld"))),S.forEach(re),S.sort(((e,t)=>t.depth-e.depth)),M.forEach(ie),S.forEach((e=>ae(e,"normalCamera"))),se(E,E,0,0,0,F/8,0,0,1,1,1),k.forEach((e=>ae(e,"normalWorld")));const _=Math.hypot(1,1),A=E.length;for(let e=0;e<A;e++){const t=M[e].z-m;E[e].z-=_*t}se(E,E,0,0,0,-F/8,0,0,1,1,1),E.forEach(ie)})(r,a,n*c,n*T,T),e.clearRect(0,0,g.width,g.height);const C=t*o;e.scale(C,C),e.translate(v,I),function(e,t,o,n){e.lineJoin="bevel",e.fillStyle=d,e.strokeStyle=d,k.forEach((t=>{if(t.wireframe){e.lineWidth=2,e.beginPath();const{vertices:o}=t,n=o.length,r=o[0];e.moveTo(r.x,r.y);for(let t=1;t<n;t++){const n=o[t];e.lineTo(n.x,n.y)}e.closePath(),e.stroke()}else{e.beginPath();const{vertices:o}=t,n=o.length,r=o[0];e.moveTo(r.x,r.y);for(let t=1;t<n;t++){const n=o[t];e.lineTo(n.x,n.y)}e.closePath(),e.fill()}})),S.forEach((t=>{if(!t.wireframe&&t.normalCamera.z<0)return;0!==t.strokeWidth&&(e.lineWidth=t.normalCamera.z<0?.5*t.strokeWidth:t.strokeWidth,e.strokeStyle=t.normalCamera.z<0?t.strokeColorDark:t.strokeColor);const{vertices:o}=t,n=o[o.length-1],r=t.middle.z>w;if(!t.wireframe){const o=.5*t.normalWorld.y+-.5*t.normalWorld.z,n=o>0?.1:(o**32-o)/2*.9+.1;e.fillStyle=J(t.color,n)}r&&(e.globalAlpha=Math.max(0,1-(t.middle.z-w)/b)),e.beginPath(),e.moveTo(n.x,n.y);for(let t of o)e.lineTo(t.x,t.y);t.wireframe||e.fill(),0!==t.strokeWidth&&e.stroke(),r&&(e.globalAlpha=1)})),e.strokeStyle="rgba(170,221,255,.9)",e.lineWidth=2.2,e.beginPath(),Me.forEach((t=>{e.moveTo(t.x,t.y);const o=(t.life/t.maxLife)**.5*1.5;e.lineTo(t.x-t.xD*o,t.y-t.yD*o)})),e.stroke(),e.strokeStyle="rgba(170,221,255,.62)";const r=f.length;for(let t=1;t<r;t++){const o=f[t],n=f[t-1];if(o.touchBreak||n.touchBreak)continue;const r=o.life/u;e.lineWidth=7*r,e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(o.x,o.y),e.stroke()}}(e),e.setTransform(1,0,0,1,0,0)}const z=()=>requestAnimationFrame(c);z()}()})()})();